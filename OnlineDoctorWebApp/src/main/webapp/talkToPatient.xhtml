<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:head>
        <title>Facelet Title</title>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script>
            var wsocket;
            var serviceLocation = "ws://" + document.location.host + "/ChatRoomTest/chat/";
            var $username;
            var $message;
            var $chatWindow;
            var room = '';

            function onMessageReceived(evt) {
                //var msg = eval('(' + evt.data + ')');
                var msg = JSON.parse(evt.data); // native API
                var $messageLine = $('<tr><td class="received">' + msg.received
                        + '</td><td class="user label label-info">' + msg.sender
                        + '</td><td class="message badge">' + msg.message
                        + '</td></tr>');
                $chatWindow.append($messageLine);
            }
            function sendMessage() {
                var msg = '{"message":"' + $message.val() + '", "sender":"'
                        + $username.val() + '", "received":""}';
                wsocket.send(msg);
                $message.val('').focus();
            }

            function connectToChatserver() {
                room = "Doctor Lewis Doctor" ; // $('#chatroom option:selected').val();
               // wsocket = new WebSocket(serviceLocation + room + $username.val());
                wsocket = new WebSocket(serviceLocation + room );
                wsocket.onmessage = onMessageReceived;
            }

            function leaveRoom() {
                wsocket.close();
                $chatWindow.empty();
                $('.chat-wrapper').hide();
                $('.chat-signin').show();
                $username.focus();
            }

            $(document).ready(function() {
                $username = $('#chatForm\\:username');
                $message = $('#do-chat\\:message');
                $chatWindow = $('#do-chat:\\response');
                $('.chat-wrapper').hide();
                $username.focus();

                $('#enterRoom').click(function(evt) {
                    evt.preventDefault();
                    connectToChatserver();
                    $('.chat-wrapper h2').text('Online Doctor Chat' + $username.val() + ":" + room);
                    $('.chat-signin').hide();
                    $('.chat-wrapper').show();
                    $message.focus();
                });
                $('#do-chat').submit(function(evt) {
                    evt.preventDefault();
                    sendMessage()
                });

                $('#leave-room').click(function() {
                    leaveRoom();
                });
            });
        </script>
    </h:head>

    <h:body>

        <div class="container chat-signin">
            <h:form id="chatForm">
  
                <h2 class="form-signin-heading">Login to Chat session</h2>
                <label for="username">Username</label>
                <h:inputText     class="input-block-level"  id="username" />
               
                <button class="btn btn-large btn-primary" type="submit" 
                        id="enterRoom">Sign in</button>
            </h:form>
        </div>
         <div class="container chat-wrapper">
            <h:form id="do-chat">

                <h2 class="alert alert-success"></h2>
                <fieldset style="width:500px">
                <table id="response" class="table table-bordered"></table>
                
                </fieldset>
                <fieldset style="width:500px">
                    <legend>Enter your message</legend>
                    <div class="controls">
                        <h:inputText  class="input-block-level"  id="message" style="width:300px"/>
                      <br/>
                      
                        <input type="submit" class="btn btn-large btn-block btn-primary"
                               value="Send message"  />
                               
                        <button class="btn btn-large btn-block" type="button" id="leave-room">Leave
                            room</button>
                    </div>
                </fieldset>
            </h:form>
        </div>
    </h:body>
</html>



